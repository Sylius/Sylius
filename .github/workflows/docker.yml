name: Docker Based Pipeline

on:
    push:
        paths-ignore:
            - "adr/**"
            - "docs/**"
            - "*.md"
    pull_request:
        paths-ignore:
            - "adr/**"
            - "docs/**"
            - "*.md"

jobs:
    static-analyze:
        name: Execute Static Analyze on Docker Compose
        runs-on: ubuntu-latest
        steps:
            -
                name: Checkout Code
                uses: actions/checkout@v3

            -
                name: Run PHPUnit, PHPSpec and Psalm
                run: docker-compose -f docker-compose.test.yml --profile static-analyze run static

    integration:
        name: Execute Behat Tests on Docker Compose
        runs-on: ubuntu-latest
        steps:
            -
                name: Checkout Code
                uses: actions/checkout@v3
                
            -
                name: Behat Configuration
                run: mv behat.yml.docker behat.yml

            -
                name: Run Behat
                run: docker compose -f docker-compose.test.yml --profile integration run behat

    javascript:
        name: Execute JS Behat Tests on Docker Compose
        runs-on: ubuntu-latest
        if: false
        steps:
            -   name: Checkout Code
                uses: actions/checkout@v3

            -   name: Behat Configuration
                run: cp behat.yml.docker behat.yml

            -   name: Run Behat
                run: |
                    docker compose -f docker-compose.test.yml --profile js up -d
                    docker compose -f docker-compose.test.yml --profile js exec app make init
                    docker compose -f docker-compose.test.yml --profile js exec app make behat-js
