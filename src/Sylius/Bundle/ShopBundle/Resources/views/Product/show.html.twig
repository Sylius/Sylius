{% extends 'SyliusShopBundle:Layout:main.html.twig' %}

{% from 'SyliusShopBundle:Product:macros.html.twig' import sylius_display_price%}

{% set form = sylius_cart_form({'product': product}) %}

{% block content %}
    <div class="ui segments">
        <div class="ui segment">
            <h3 class="ui dividing header" id="sylius_product_name">
                {{ product.name }}
            </h3>
            <div>
                {% if product.attributes|length > 0 %}
                    <table class="ui single line table" id="product-attributes">
                        <thead>
                        <tr>
                            <th colspan="2">{{ 'sylius.ui.attributes'|trans }}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for attribute in product.attributes %}
                            <tr>
                                <td id="sylius_attribute_name">
                                    {{ attribute.name }}
                                </td>
                                {% set attributeTemplate = 'SyliusAttributeBundle:Types:' ~ attribute.attribute.type ~ '.html.twig' %}
                                {% include [attributeTemplate, 'SyliusShopBundle:Product:_attribute.html.twig'] with {'attribute': attribute} %}
                            </tr>
                        {% endfor %}
                        </tbody>
                        </table>
                {% endif %}
            </div>
            <div class="ui hidden divider"></div>
            <form action="{{ path('sylius_shop_cart_item_add', {'id': product.id}) }}" method="post">
                <div class="ui two column grid">
                    <div class="column">
                        {% if product.hasVariants %}
                            {% if product.isVariantSelectionMethodChoice %}
                                <table class="ui single line table" id="product-variants">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>{{ 'sylius.ui.price'|trans }}</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% for variant in product.variants if variant.available %}
                                        <tr>
                                            <td>
                                                {% if variant.presentation is empty %}
                                                    {% for option in variant.options %}
                                                        <strong>{{ option.presentation }}</strong>: {{ option.value }}
                                                    {% endfor %}
                                                {% else %}
                                                    {{ variant.presentation }}
                                                {% endif %}
                                            </td>
                                            <td>
                                                {{ sylius_display_price(variant) }}
                                            </td>
                                            <td>
                                                {% if sylius_inventory_is_available(variant) %}
                                                    {{ form_widget(form.variant[loop.index0]) }}
                                                {% else %}
                                                    <span>{{ 'sylius.ui.out_of_stock'|trans }}</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <div>
                                    {{ form_widget(form.variant) }}
                                </div>
                            {% endif %}
                        {% else %}
                            <h4>
                                <span>
                                {{ sylius_display_price(product.masterVariant) }}
                                </span>
                                {{ 'sylius.ui.price'|trans }}
                            </h4>
                        {% endif %}
                    </div>
                    <div class="column">
                        {% if not product.hasVariants and not sylius_inventory_is_available(product.masterVariant) %}
                            <span class="ui red label">{{ 'sylius.ui.out_of_stock'|trans }}</span>
                        {% else %}
                            {{ form_row(form.quantity, {'empty_value': '1'}) }}
                            {{ form_widget(form._token) }}
                            <div class="ui hidden divider"></div>
                            {% if sylius_is_restricted(product) %}
                                <button disabled="disabled" class="ui labeled icon button">
                                    <i class="icon cart"></i>
                                    {{ 'sylius.ui.not_available_in_your_country'|trans }}
                                </button>
                            {% else %}
                                <button type="submit" class="ui labeled icon button">
                                    <i class="icon cart"></i>
                                    {{ 'sylius.ui.add_to_cart'|trans }}
                                </button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>
    </div>
{% endblock %}
