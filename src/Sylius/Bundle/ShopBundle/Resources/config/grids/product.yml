# This file is part of the Sylius package.
# (c) Paweł Jędrzejewski

sylius_grid:
    grids:
        sylius_shop_product:
            driver:
                name: elastica
                options:
                    type: product
                    query:
                        and:
                            - term:
                                enabled: true
                            - nested:
                                path: variants
                                query:
                                    bool:
                                        minimum_number_should_match: 1
                                        should:
                                            range:
                                                variants.onHand: { gt: 0 }
                                        must:
                                            filtered:
                                                filter:
                                                    or:
                                                        - missing: { field: variants.availableOn }
                                                        - range: { variants.availableOn: { lte: now } }
                                                    or:
                                                        - missing: { field: variants.availableUntil }
                                                        - range: { variants.availableUntil: { gte: now } }
                            - nested:
                                path: channels
                                filter:
                                    bool:
                                        must:
                                            term: { 'channels.code': "expr:service('sylius.context.channel').getChannel().getCode()" }
            filters:
                _all:
                    type: elastica
                taxons.code:
                    type: elastica
            sorting:
                position: asc
            fields:
                createdAt:
                    type: datetime
                    label: sylius.ui.date
                    sortable: ~
                    options:
                        format: m/d/Y
                position: 
                    type: string  #not use but expected
                    sortable: productTaxon.position
            filters:
                search:
                    type: string
                    template: "@SyliusShop/Grid/Filter/string.html.twig"
                    options:
                        fields: [translation.name]
