# This file is part of the Sylius package.
# (c) Paweł Jędrzejewski

imports:
    - { resource: "@SyliusCoreBundle/Resources/config/app/config.yml" }
    - { resource: "@SyliusAdminBundle/Resources/config/app/config.yml" }
    - { resource: "@SyliusShopBundle/Resources/config/app/config.yml" }
    - { resource: "@SyliusApiBundle/Resources/config/app/config.yml" }

    - { resource: "parameters.yml" }
    - { resource: "security.yml" }

framework:
    translator: { fallbacks: ["%locale%"] }
    secret: "%secret%"
    router:
        resource: "%kernel.root_dir%/config/routing.yml"
        strict_requirements: "%kernel.debug%"
    form: true
    csrf_protection: true
    validation: { enable_annotations: true }
    templating: { engines: ["twig"] }
    default_locale: "%locale%"
    trusted_proxies: ~
    session:
        handler_id: ~

doctrine:
    dbal:
        driver: "%database_driver%"
        host: "%database_host%"
        port: "%database_port%"
        dbname: "%database_name%"
        user: "%database_user%"
        password: "%database_password%"
        charset: UTF8

doctrine_migrations:
    dir_name: "%kernel.root_dir%/migrations"
    namespace: Sylius\Migrations
    table_name: sylius_migrations
    name: Sylius Migrations

swiftmailer:
    transport: "%mailer_transport%"
    host: "%mailer_host%"
    username: "%mailer_user%"
    password: "%mailer_password%"

fos_rest:
    view:
        formats:
            json: true
            xml:  true
        empty_content: 204
    format_listener:
        rules:
            - { path: '^/api', priorities: ['json', 'xml'], fallback_format: json, prefer_extension: true }
            - { path: '^/', stop: true }

fos_elastica:
    clients:
        elasticsearch:
            servers:
                - { host: %elastica_host%, port: %elastica_port% }
    indexes:
        sylius:
            client: elasticsearch
            finder: ~
            settings:
                analysis:
                    analyzer:
                        sylius_search_analyzer:
                            type: custom
                            tokenizer: standard
                            filter   : [lowercase, asciifolding, synonym]
                        sylius_index_analyzer:
                            type: custom
                            tokenizer: standard
                            filter   : [lowercase, asciifolding, synonym, sylius_filter]
                    filter:
                        sylius_filter:
                            type: edgeNGram
                            min_gram: 1
                            max_gram: 12
                        synonym:
                            type: synonym
                            expand: true
                            ignore_case: true
                            synonyms: synonym.txt
            types:
                product:
                    search_analyzer: sylius_search_analyzer
                    index_analyzer: sylius_index_analyzer
                    mappings:
                        id: { type: integer, index: not_analyzed }
                        code: { type: string, analyzer: sylius_index_analyzer }
                        name: { type: string, analyzer: sylius_index_analyzer }
                        description: { type: string }
                        price: { type: integer }
                        shortDescription: { type: string }
                        slug: { type: string, index: not_analyzed }
                        translations:
                            type: nested
                            properties:
                                locale: { type: string, index: not_analyzed }
                                name: { type: string }
                                metaKeywords: { type: string }
                                metaDescription: { type: string }
                        variants:
                            type: nested
                            properties:
                                code: { type: string }
                                availableOn: { type: date, index: not_analyzed }
                                availableUntil: { type: date, index: not_analyzed }
                                name: { type: string }
                                onHand: { type: integer, index: not_analyzed }
                                onHold: { type: integer, index: not_analyzed }
                        attributes:
                            type: nested
                            properties:
                                value: { type: string }
                        channels:
                            type: nested
                            properties:
                                code: { type: string, index: not_analyzed }
                        productTaxons:
                            type: nested
                            properties:
                                taxon:
                                    type: nested
                                    properties:
                                        code: { type: string, index: not_analyzed }
                        mainTaxon:
                            type: nested
                            properties:
                                code: { type: string, index: not_analyzed }
                        images:
                            type: nested
                            properties:
                                path: { type: string, index: not_analyzed }
                                code: { type: string, index: not_analyzed }
                        enabled: { type: boolean }
                        isSimple: { type: boolean }
                    persistence:
                        driver: orm
                        model: Sylius\Component\Core\Model\Product
                        provider: ~
                        listener: ~
                        finder: ~
