language: php

php:
  - 5.3
  - 5.4
  - 5.5

env:
  global:
    - secure: "P9+lNYQxmYudD1NsWGxcGdXlX/jE64UCeIcnNxbTAsYjdjnwB8yB9CyBj3qI\nPxRhYNZAQxR0Asd4F2VF0LVxMojZ1mZHLbuOQFU2ua4VEfHqMn2VZGuC/oem\nKxpf2lfYuTU/92KxJ6b19op7fLk70KCyFrbVzWm6kDpvjWuks/U="
    - secure: "KObpQBDsdS6VU1UXpAEFa3yuoQooFpmtQzpPLkQ88QWL3ixFWai9oZ+g5oaf\nCfgC/eVAa7zHHu3/keF2rxF4TzxEq7ENLDrBOqsQJIK4mt3qMWbWf+aMAMki\nDMcumM7T9LTQvO+nr9lBjzME2UZGtjgEnV1U1j/pA/71+p+xH88="

matrix:
    allow_failures:
        - php: 5.5

addons:
  sauce_connect: true

before_script:
    - echo '' > ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini
    - sudo apt-get update > /dev/null
    - sudo apt-get install -y --force-yes apache2 libapache2-mod-php5 php5-curl php5-mysql php5-intl
    - sudo sed -i -e "/DocumentRoot/i\ServerName sylius.local" /etc/apache2/sites-available/default
    - echo "127.0.0.1 sylius.local" | sudo tee -a /etc/hosts
    - sudo sed -i -e "s,/var/www,$(pwd)/web,g" /etc/apache2/sites-available/default
    - sudo /etc/init.d/apache2 restart
    - sudo /etc/init.d/mysql restart
    - composer self-update
    - composer install --dev --prefer-source --no-interaction > /dev/null
    - app/console doctrine:database:create --env=test > /dev/null
    - app/console doctrine:schema:create --env=test > /dev/null
    - chmod -R 777 app/cache app/logs
    - app/console cache:warmup --env=test > /dev/null
    - chmod -R 777 app/cache app/logs
    - sed -i "s/your_saucelabs_username/$SAUCE_USERNAME/" behat.yml.dist
    - sed -i "s/your_saucelabs_apikey/$SAUCE_ACCESS_KEY/" behat.yml.dist

script:
#   - php -d memory_limit=2048M bin/behat --no-snippets --no-paths --verbose -p frontend
#   - php -d memory_limit=2048M bin/behat --no-snippets --no-paths --verbose -p backend
    - bin/behat --no-snippets --no-paths --expand -p saucelabs
#   - cd src/Sylius/Bundle/CoreBundle; ../../../../bin/phpspec run -fpretty --verbose

notifications:
  email: "travis-ci@sylius.org"
  irc:   "irc.freenode.org#sylius-dev"
