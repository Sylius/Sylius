name: sylius
recipe: symfony
config:
    php: '8.0'
    xdebug: true
    webroot: public
    database: mysql
    config:
        php: lando/php.ini

services:
    database:
        portforward: true
        creds:
            database: sylius_dev
        host: database
    appserver:
        # for behat config
        host: appserver
        ports:
            - '8080:8080'
        run_as_root:
            - lando/scripts/entrypoint.sh
            - apt-get update -y
#            uncomment to run behat JS
#            - curl -sS https://get.symfony.com/cli/installer | bash
#            - mv /root/.symfony/bin/symfony /usr/local/bin/symfony
#            - symfony server:ca:install
#            - APP_ENV=test symfony server:start --port=8080 --dir=public --allow-http --force-php-discovery -d
        overrides:
            environment:
                LANDO_HOST_IP: "host.docker.internal"
                XDEBUG_CONFIG: "remote_enable=1 remote_host=host.docker.internal"
                PHP_IDE_CONFIG: "serverName=sylius.lndo.site"
                PHP_INI_XDEBUG__REMOTE_PORT: "9003"
            extra_hosts:
                - ${LANDO_HOST_IP_DEV:-host}:host-gateway
    node:
        type: node
#    uncomment to run behat JS
#    chrome:
#        host: chrome
#        portforward: true
#        type: compose
#        services:
#            image: alpeware/chrome-headless-trunk
#            command: /usr/bin/google-chrome-unstable \
#                --disable-gpu --headless --no-sandbox --window-size=1440,900 \
#                --remote-debugging-address=0.0.0.0 \
#                --remote-debugging-port=9222 --user-data-dir=/data
#            ports:
#                - '9222:9222'

tooling:
    behat:
        service: appserver
        cmd: vendor/bin/behat
        description: Runs behat tests
    spec:
        service: appserver
        cmd: vendor/bin/phpspec
        description: Runs PHPSpec
    unit:
        service: appserver
        cmd: vendor/bin/phpunit
        description: Runs PHPUnit
    cc:
        service: appserver
        cmd: rm -fr var/cache
        description: Forcefully Clears cache
    yarn:
        service: node
        cmd: yarn
        description: run yarn commands
